<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>CMO 3D Cat</title>
<style>
  body{margin:0;overflow:hidden;background:#000;}
  #hud{
    position:fixed;left:10px;top:10px;color:#fff;
    font:14px Arial;background:rgba(0,0,0,0.4);
    padding:8px;border-radius:8px;z-index:9999;
  }
</style>
</head>
<body>

<div id="hud">WASD 이동</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/examples/js/loaders/GLTFLoader.js"></script>

<script>
// ===== 기본 3D 세팅 =====
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x202020);

const camera = new THREE.PerspectiveCamera(
  75, window.innerWidth/window.innerHeight, 0.1, 1000
);
camera.position.set(0,3,6);

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

const light = new THREE.DirectionalLight(0xffffff,1);
light.position.set(5,10,5);
scene.add(light);

const ambient = new THREE.AmbientLight(0xffffff,0.4);
scene.add(ambient);

// 바닥
const floor = new THREE.Mesh(
  new THREE.PlaneGeometry(50,50),
  new THREE.MeshStandardMaterial({color:0x333333})
);
floor.rotation.x = -Math.PI/2;
scene.add(floor);

// ===== 고양이 로드 =====
let player = null;

const loader = new THREE.GLTFLoader();
loader.load(
  "assets/cat.glb",
  (gltf) => {
    player = gltf.scene;
    player.scale.set(1,1,1);   // 크기 조절 (0.5 등으로 바꿔도 됨)
    player.position.set(0,0,0);
    scene.add(player);
    console.log("Cat loaded");
  },
  undefined,
  (err) => {
    console.log("Cat load failed", err);

    // 실패 시 임시 구
    const geo = new THREE.SphereGeometry(0.6,24,24);
    const mat = new THREE.MeshStandardMaterial({color:0x00ff00});
    player = new THREE.Mesh(geo,mat);
    player.position.set(0,0.6,0);
    scene.add(player);
  }
);

// ===== 이동 =====
const keys = {};
let px = 0, pz = 0;
const speed = 0.08;

document.addEventListener("keydown",(e)=>{
  keys[e.key.toLowerCase()] = true;
});
document.addEventListener("keyup",(e)=>{
  keys[e.key.toLowerCase()] = false;
});

function updateMove(){
  if(!player) return;

  if(keys["w"]) pz -= speed;
  if(keys["s"]) pz += speed;
  if(keys["a"]) px -= speed;
  if(keys["d"]) px += speed;

  player.position.x = px;
  player.position.z = pz;
}

// ===== 애니메이션 =====
function animate(){
  requestAnimationFrame(animate);

  updateMove();

  if(player){
    camera.position.x = player.position.x;
    camera.position.z = player.position.z + 6;
    camera.lookAt(player.position);
  }

  renderer.render(scene,camera);
}
animate();

// ===== 화면 리사이즈 대응 =====
window.addEventListener("resize", ()=>{
  camera.aspect = window.innerWidth/window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
});
</script>

</body>
</html>
